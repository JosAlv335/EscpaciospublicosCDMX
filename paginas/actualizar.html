<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Actualizar Datos</title>
    <link href='https://unpkg.com/css.gg@2.0.0/icons/css/search.css' rel='stylesheet'>
    <link rel="stylesheet" href="../assets/css/actualizar.css">
</head>
<body>
    <header>
        <h1>Actualizar Datos</h1>
    </header>
    <main>
        <div id="mensaje"></div> <!-- Para mostrar mensajes de éxito o erro r -->

        

        <form id="updateForm">
            <div class="form-group">
                <label for="id" name="id">ID:</label>
                <input type="text" id="id" name="id" required>
            </div>

            <div class="form-group" id="CP-Tipo">
                <div class="_CP">
                    <label for="codigoPostal">Código Postal:</label>
                    <input type="text" id="codigoPostal" name="codigoPostal" maxlength="5">
                    <button type="button" id="srchCP" name="srchCP"><i class="gg-search"></i>Buscar código postal</button>
                </div>
                <div class="tipo-espacio">
                    <label for="tipo-espacio">Tipo de espacio:</label>
                    <select id="tipo-espacio" name="tipo-espacio">
                        <option value="" selected disabled>Selecciona un tipo de espacio...</option>
                        <option value="Parque">Parque</option>
                        <option value="Deportivo">Deportivo</option>
                    </select>
                </div>
                
                
            </div>

            <div class="form-group" id = "estado-municipio">
                
                <div class = "estado">
                    <label for="estado">Estado:</label>
                    <select id="estado" name="estado">
                        <option value="" selected disabled>Selecciona un estado</option>
                    </select>
                </div>
                <div class = "municipio">
                    <label for="ciudad_municipio">Ciudad/Municipio:</label>
                    <select id="ciudad_municipio" name="ciudad_municipio">
                        <option value="" selected disabled>Selecciona una ciudad/municipio</option>
                    </select>
                </div>

            </div>

            <div class="form-group" id = "asentamiento-calle">

                <div class="asentamiento">
                    <label for="asentamiento">Asentamiento:</label>
                    <select id="asentamiento" name="asentamiento">
                        <option value="" selected disabled>Selecciona un asentamiento</option>
                    </select>
                </div>
                <div class="calle">
                    <label for="calle">Calle:</label>
                    <input type="text" id="calle" name="calle">
                </div>

            </div>

            <diV class="form-group" id = "entreCalles-Nums">

                <div class="entre-calles">
                    <label for="entCalles">Entre Calles:</label>
                    <input type="text" id="entCalles" name="entCalles">
                </div>
                <div class="numExt">
                    <label for="numExt">Num. Ext.:</label>
                    <input type="text" id="numExt" name="numExt">
                </div>
                <div class="numInt">
                    <label for="numInt">Num Int.:</label>
                    <input type="text" id="numInt" name="numInt">
                </div>

            </diV>

            <div class="form-group" id="horarios">

                <div class="horario-inicio">
                    <label for="horario-inicio">Hora de apertura:</label>
                    <input type="time" id="horario-inicio" name="horario-inicio">
                </div>
                <div class="horario-fin">
                    <label for="horario-fin">Hora de cierre:</label>
                    <input type="time" id="horario-fin" name="horario-fin">
                </div>

            </div>


            <div class="form-group">
                <label for="nombre">Nombre:</label>
                <input type="text" id="nombre" name="nombre">
            </div>

            <div class="form-group" id ="control-buttons">
                <button type="button" id="regresarTabla" class="cancel-button">Cancelar</button>
                <button type="button" id="subirDatos" class="register-button">Continuar</button>
            </div>
            
            <div class ="cuadro-emergente" id="confirmacion">
                <div class="contenido-emergente">
                    <h2>Confirmación</h2>
                    <p>He actualizado correctamente los datos</p>
                    <button type="button" id="regresarForm" class="cancel-button">Cancelar</button>
                    <button type="submit" id="confirm-add" class="add-button" name="agregar">Confirmar</button>
                </div>
            </div>

        </form>

    </main>

    <!-- Para mostrar u ocultar el cuadro emergente -->
    <script>
        // Obtener el cuadro emergente
        var cuadroEmergente = document.getElementById("confirmacion");

        // Obtener el botón que abre el cuadro emergente
        var btnMostrar = document.getElementById("subirDatos");

        // Obtener el botón que cierra el cuadro emergente
        var btnCancelar = document.getElementById("regresarForm");

        // Obtener el botón que simula la acción de aceptar
        var btnAceptar = document.getElementById("confirm-add");

        // Cuando el usuario hace clic en el botón, abrir el cuadro emergente
        btnMostrar.onclick = function() {
            cuadroEmergente.style.display = "block";
            setTimeout(() => { // Esto permite que la transición CSS se aplique correctamente
                cuadroEmergente.style.opacity = "1";
                cuadroEmergente.querySelector('.contenido-emergente').style.transform = "scale(1)";
            }, 10);
        }

        // Cuando el usuario hace clic en "Cancelar", cierra el cuadro emergente
        btnCancelar.onclick = function() {
            cuadroEmergente.style.opacity = "0";
            cuadroEmergente.querySelector('.contenido-emergente').style.transform = "scale(0.7)";
            setTimeout(() => {
                cuadroEmergente.style.display = "none";
            }, 500); // Espera hasta que la animación termine
        }

        // Cuando el usuario hace clic en "Aceptar", realiza una acción y cierra el cuadro
        btnAceptar.onclick = function() {
            // Aquí puedes agregar la lógica para manejar la "aceptación"
            cuadroEmergente.style.opacity = "0";
            cuadroEmergente.querySelector('.contenido-emergente').style.transform = "scale(0.7)";
            setTimeout(() => {
                cuadroEmergente.style.display = "none";
            }, 500); // Espera hasta que la animación termine
        }

        // También puedes cerrar el cuadro emergente si el usuario hace clic fuera de él
        window.onclick = function(event) {
            if (event.target == cuadroEmergente) {
                cuadroEmergente.style.display = "none";
            }
        }
    </script>
    <!-- Para cargar los datos en la base -->
    <script>
        document.getElementById("updateForm").addEventListener("submit", function(event) {
            event.preventDefault(); // Evitar el envío del formulario por defecto

            var formData = new FormData(this); // Obtener los datos del formulario

            var xhr = new XMLHttpRequest(); // Crear un objeto XMLHttpRequest
            console.log(xhr.OPENED);
            console.log(xhr.status + xhr.statusText);
            xhr.open("POST", "../assets/php/procesar_actualizar.php", true); // Establecer la solicitud POST a procesar_actualizar.php
            console.log(xhr.OPENED);
            xhr.onreadystatechange = function() {
                if (xhr.readyState == 4 && xhr.status == 200) {
                    document.getElementById("mensaje").innerHTML = xhr.responseText; // Mostrar la respuesta del servidor en el elemento "mensaje"
                }
            };

            xhr.onload = function () {
                if (this.status == 200) {
                    console.log(this.response);
                } else {
                    var formulario = document.getElementById("updateForm");
                    var elementosFormulario = formulario.elements;

                    for (var i = 0; i < elementosFormulario.length; i++) {
                        var elemento = elementosFormulario[i];
                        console.log(elemento.name + ": " + elemento.value);
                    }
                    console.error("Error en la petición: " + this.status + this.responseXML);
                }
            };

            xhr.send(formData); // Enviar los datos del formulario al servidor
        });

        

        document.getElementById("regresarTabla").addEventListener("click", function() {
            window.location.href = "tabla.html"; // Redirigir a tabla.html
        });
    </script>
    <script src="../assets/js/addSpace.js"></script>

</body>
</html>
